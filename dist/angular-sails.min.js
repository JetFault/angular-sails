!function(t,n){"use strict";t.module("ngSails",["ng"]),t.module("ngSails").provider("$sails",function(){var o=this,e=["get","post","put","delete"],r=["on","once"],s=[],i=[];this.socketHostPort=void 0,this.socketOptions=void 0,this.autoConnect=n.sails.autoConnect,this.resolveOrRejectHandler=void 0,this.addRequestTransform=function(t){s.push(t)},this.addResponseTransform=function(t){i.push(t)},this.$get=["$q","$timeout","$injector",function(s,i,c){function u(){d.rawSocket=n.connect(o.socketHostPort,o.socketOptions),v.resolve(d)}function a(){d.rawSocket.disconnect(),d.rawSocket=null,v=s.defer()}function f(n){var e=this;e[n]=function(r,i,c){-1!==["put","post","patch","delete"].indexOf(n)&&(i=i||{});var u={data:i,method:n,url:r,headers:c},a=function(t){var n=s.defer();return e.rawSocket[t.method](t.url,t.data,function(t,o){s.when(l(t,o)).then(function(t){n.resolve(t)}).catch(function(t){n.reject(t)})}),n.promise},f=[a],h=s.when(u);for(t.forEach(o.transformRequest,function(t){f.unshift(t)}),t.forEach(o.transformResponse,function(t){f.push(t)});f.length;)h=h.then(f.shift());return h}}function h(n){var o=this;o[n]=function(e,r){v.promise.then(function(){null!==r&&t.isFunction(r)&&o.rawSocket[n](e,function(t){i(function(){r(t)})})})}}var d,l,v=s.defer();return o.autoConnect&&u(),l=function(n,o){var e={data:n,jwr:o};return o&&t.isObject(o)&&o.statusCode&&!isNaN(o.statusCode)&&2!==Math.floor(o.statusCode/100)?s.reject(e):e},o.rejectOrResolveHandler&&(l=c.invoke(this.rejectOrResolveHandler)),t.forEach(o.transformRequest,function(t){t=c.invoke(t)}),t.forEach(o.transformResponse,function(t){t=c.invoke(t)}),t.forEach(e,f.bind(d)),t.forEach(r,h.bind(d)),d.connect=function(){u()},d.disconnect=function(){a()},d}]})}(angular,io);