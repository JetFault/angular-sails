!function(t,n){"use strict";t.module("ngSails",["ng"]),t.module("ngSails").provider("$sails",function(){var e=this,o=["get","post","put","delete"],c=["on","once"],i=[],r=[];this.socketHostPort=void 0,this.socketOptions=void 0,this.autoConnect=n.sails.autoConnect,this.resolveOrRejectHandler=void 0,this.addRequestTransform=function(t){i.push(t)},this.addResponseTransform=function(t){r.push(t)},this.$get=["$q","$timeout","$injector",function(s,u,a){function f(){k.rawSocket=n.connect(e.socketHostPort,e.socketOptions),m.resolve(k)}function h(){k.rawSocket.disconnect(),k.rawSocket=null,m=s.defer()}function d(n){var o=this;o[n]=function(c,i,r){if(!o.rawSocket)return s.reject(new v);-1!==["put","post","patch","delete"].indexOf(n)&&(i=i||{});var u={data:i,method:n,url:c,headers:r},a=function(t){var n=s.defer();return o.rawSocket[t.method](t.url,t.data,function(t,e){s.when(p(t,e)).then(function(t){n.resolve(t)}).catch(function(t){n.reject(t)})}),n.promise},f=[a],h=s.when(u);for(t.forEach(e.transformRequest,function(t){f.unshift(t)}),t.forEach(e.transformResponse,function(t){f.push(t)});f.length;)h=h.then(f.shift());return h}}function l(n){var e=this;e[n]=function(o,c){m.promise.then(function(){null!==c&&t.isFunction(c)&&e.rawSocket[n](o,function(t){u(function(){c(t)})})})}}function v(){this.name="SocketNotConnectedException",this.message="Socket has not been connected before attempting to run a socket request"}var p,k={},m=s.defer();return e.autoConnect&&f(),p=function(n,e){var o={data:n,jwr:e};return e&&t.isObject(e)&&e.statusCode&&!isNaN(e.statusCode)&&2!==Math.floor(e.statusCode/100)?s.reject(o):o},e.rejectOrResolveHandler&&(p=a.invoke(this.rejectOrResolveHandler)),t.forEach(i,function(t){t=a.invoke(t)}),t.forEach(r,function(t){t=a.invoke(t)}),t.forEach(o,d.bind(k)),t.forEach(c,l.bind(k)),k.connect=function(){f()},k.disconnect=function(){h()},k}]})}(angular,io);