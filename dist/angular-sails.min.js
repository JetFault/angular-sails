!function(t,n){"use strict";t.module("ngSails",["ng"]),t.module("ngSails").provider("$sails",function(){var e=this,o=["get","post","put","delete"],c=["on","once"],i=[],r=[];this.socketHostPort=void 0,this.socketOptions=void 0,this.autoConnect=n.sails.autoConnect,this.resolveOrRejectHandler=void 0,this.addRequestTransform=function(t){i.push(t)},this.addResponseTransform=function(t){r.push(t)},this.$get=["$q","$timeout","$injector",function(s,u,a){function f(o){p.rawSocket||(p.rawSocket=n.connect(e.socketHostPort,t.extend({},e.socketOptions,o)),m.resolve(p))}function h(){p.rawSocket&&p.rawSocket.disconnect(),p.rawSocket=null,m=s.defer()}function d(n){var e=this;e[n]=function(o,c,u){if(!e.rawSocket)return s.reject(new k);-1!==["put","post","patch","delete"].indexOf(n)&&(c=c||{});var a={data:c,method:n,url:o,headers:u},f=function(t){var n=s.defer();return e.rawSocket[t.method](t.url,t.data,function(t,e){s.when(v(t,e)).then(function(t){n.resolve(t)}).catch(function(t){n.reject(t)})}),n.promise},h=[f],d=s.when(a);for(t.forEach(i,function(t){h.unshift(t)}),t.forEach(r,function(t){h.push(t)});h.length;)d=d.then(h.shift());return d}}function l(n){var e=this;e[n]=function(o,c){m.promise.then(function(){null!==c&&t.isFunction(c)&&e.rawSocket[n](o,function(t){u(function(){c(t)})})})}}function k(){this.name="SocketNotConnectedException",this.message="Socket has not been connected before attempting to run a socket request"}var v,p={},m=s.defer();return e.autoConnect&&f(),v=function(t,n){n.data=n.body,n.status=n.statusCode,s.reject(n.error?n:n)},e.rejectOrResolveHandler&&(v=a.invoke(this.rejectOrResolveHandler)),t.forEach(i,function(t){t=a.invoke(t)}),t.forEach(r,function(t){t=a.invoke(t)}),t.forEach(o,d.bind(p)),t.forEach(c,l.bind(p)),p.connect=function(t){f(t)},p.disconnect=function(){h()},p}]})}(angular,io);