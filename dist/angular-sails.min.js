!function(t,n){"use strict";t.module("ngSails",["ng"]),t.module("ngSails").provider("$sails",function(){var e=this,o=["get","post","put","delete"],r=["on","once"],s=[],c=[];this.socketHostPort=void 0,this.socketOptions=void 0,this.autoConnect=n.sails.autoConnect,this.resolveOrRejectHandler=void 0,this.addRequestTransform=function(t){s.push(t)},this.addResponseTransform=function(t){c.push(t)},this.$get=["$q","$timeout","$injector",function(s,c,i){function a(){l.rawSocket=n.connect(e.socketHostPort,e.socketOptions),p.resolve(l)}function u(){l.rawSocket.disconnect(),l.rawSocket=null,p=s.defer()}function f(n){var o=this;o[n]=function(r,c,i){if(!o.rawSocket)return s.reject(new d);-1!==["put","post","patch","delete"].indexOf(n)&&(c=c||{});var a={data:c,method:n,url:r,headers:i},u=function(t){var n=s.defer();return o.rawSocket[t.method](t.url,t.data,function(t,e){s.when(v(t,e)).then(function(t){n.resolve(t)}).catch(function(t){n.reject(t)})}),n.promise},f=[u],h=s.when(a);for(t.forEach(e.transformRequest,function(t){f.unshift(t)}),t.forEach(e.transformResponse,function(t){f.push(t)});f.length;)h=h.then(f.shift());return h}}function h(n){var e=this;e[n]=function(o,r){p.promise.then(function(){null!==r&&t.isFunction(r)&&e.rawSocket[n](o,function(t){c(function(){r(t)})})})}}function d(){this.name="SocketNotConnectedException",this.message="Socket has not been connected before attempting to run a socket request"}var l,v,p=s.defer();return e.autoConnect&&a(),v=function(n,e){var o={data:n,jwr:e};return e&&t.isObject(e)&&e.statusCode&&!isNaN(e.statusCode)&&2!==Math.floor(e.statusCode/100)?s.reject(o):o},e.rejectOrResolveHandler&&(v=i.invoke(this.rejectOrResolveHandler)),t.forEach(e.transformRequest,function(t){t=i.invoke(t)}),t.forEach(e.transformResponse,function(t){t=i.invoke(t)}),t.forEach(o,f.bind(l)),t.forEach(r,h.bind(l)),l.connect=function(){a()},l.disconnect=function(){u()},l}]})}(angular,io);