!function(t,e){"use strict";t.module("ngSails",["ng"]),t.module("ngSails").provider("$sails",function(){var n=this,o=["get","post","put","delete"],c=["on","once"],r=[],i=[];this.socketHostPort=void 0,this.socketOptions=void 0,this.autoConnect=e.sails.autoConnect,this.resolveOrRejectHandler=void 0,this.addRequestTransform=function(t){r.push(t)},this.addResponseTransform=function(t){i.push(t)},this.$get=["$q","$timeout","$injector",function(s,a,u){function f(o){p.rawSocket||(p.rawSocket=e.connect(n.socketHostPort,t.extend({},n.socketOptions,o)),m.resolve(p))}function h(){p.rawSocket&&p.rawSocket.disconnect(),p.rawSocket=null,m=s.defer()}function d(e){var o=this;o[e]=function(c,r,i){if(!o.rawSocket)return s.reject(new v);-1!==["put","post","patch","delete"].indexOf(e)&&(r=r||{});var a={data:r,method:e,url:c,headers:i},u=function(t){var e=s.defer();return o.rawSocket[t.method](t.url,t.data,function(t,n){s.when(k(t,n)).then(function(t){e.resolve(t)}).catch(function(t){e.reject(t)})}),e.promise},f=[u],h=s.when(a);for(t.forEach(n.transformRequest,function(t){f.unshift(t)}),t.forEach(n.transformResponse,function(t){f.push(t)});f.length;)h=h.then(f.shift());return h}}function l(e){var n=this;n[e]=function(o,c){m.promise.then(function(){null!==c&&t.isFunction(c)&&n.rawSocket[e](o,function(t){a(function(){c(t)})})})}}function v(){this.name="SocketNotConnectedException",this.message="Socket has not been connected before attempting to run a socket request"}var k,p={},m=s.defer();return n.autoConnect&&f(),k=function(e,n){var o={data:e,jwr:n};return n&&t.isObject(n)&&n.statusCode&&!isNaN(n.statusCode)&&2!==Math.floor(n.statusCode/100)?s.reject(o):o},n.rejectOrResolveHandler&&(k=u.invoke(this.rejectOrResolveHandler)),t.forEach(r,function(t){t=u.invoke(t)}),t.forEach(i,function(t){t=u.invoke(t)}),t.forEach(o,d.bind(p)),t.forEach(c,l.bind(p)),p.connect=function(t){f(t)},p.disconnect=function(){h()},p}]})}(angular,io);